<!DOCTYPE html>
<html lang="ru">
    <head>
        <title>audio2</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src='https://kit.fontawesome.com/56cc19ca60.js' crossorigin="anonymous"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

        <link rel="stylesheet" href="/resources/css/audio.css">
        <link rel="stylesheet" href="/resources/css/cube2.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600&display=swap" rel="stylesheet">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Cinzel:wght@600&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />


        <style>
            .material-symbols-outlined {
                font-variation-settings:
                        'FILL' 0,
                        'wght' 700,
                        'GRAD' 200,
                        'opsz' 48
            }
            #menuButtonsIconsWrapper{
                position: relative;
                width: 25%;
                height: 100%;
                border: 1px solid black;
                margin: 5%;
                float: left;
            }


            .pl_icon_wrapper{
                display: block;
                font-size: 25px;
                text-align: center;
                height: 22%;
                width: 25%;
                border-radius: 50%;
                margin: 15%;
            }

            .pl_select_el{
                position: relative;
                width: 100px;
                margin: 15%;
                height: 100px;
                border: 1px solid red;
                display: block;
            }

            .playlistElem{
                position: relative;
                height: 15%;
                margin: 12%;
                border: 1px solid red;
                width: 22%;
            }

            #searchWrapper{
                position: relative;

                left: 69%;
                padding: 0;
                top: 3%;
                width: 25%;
                outline: none;
                border-radius: 10px;
                float: left;
            }
            #search_input{
                flex: none;
                position: relative;
                width: 15em;
                height: 70%;
                transition: 0.4s ease-in-out;
                background: rgb(13 12 12 / 46%);
                outline: none;
                box-shadow: 0 0 5px 0 #00ffb8;
                border: 1px solid #4e4e4d;
                border-radius: 10px;
                color: #00ff9f;
                font-family: 'Audiowide', monospace;
                font-size: 21px;
                text-shadow: 0 0 2px cyan;
            }

            #songs{
                position: absolute;
                width: 30%;
                height: 30%;
                border: 1px solid crimson;
                top: 10%;
            }
            .canSet{
                position: relative;
                width: 50%;
                height: 50%;
                border: 1px solid red;
                padding: 6px;

            }
            .trackSettings{
                transform: translateX(105px);
                /*height: 100%;*/
                /*width: 10em;*/

                border-radius: 10%;
                transition: 0.3s ease-out;
                text-align: left;
                flex: none;
                display: flex;
                justify-content: flex-start;
                color: #f60228;
                font-size: 15px;
            }

            .trackSettingLabels {
                font-size: 20px;
                margin: 15px;
                color: #ccff0af9;
            }

            .trackSettingLabels:hover {
                color: white;
                text-shadow: 0 0 3px white;
            }



            #playListsPane{
                position: absolute;
                width: 100%;
                float: right;
                height: 90%;
                overflow-y: scroll;
                overflow-x: hidden;
                border-radius: 4%;
                background: radial-gradient(white, black);
                /*backdrop-filter: blur(10px);*/
                top: 8%;
                transition: 1s linear;
                opacity: 0;
            }

            .playlists_pane_elem_container{
                display: inline-block;
                width: 15%;
                height: 21%;
                border: 1px solid #eb5353;
                border-radius: 15px;
                margin: 1%;
                transition: 1s ease-out;
                overflow: hidden;
            }

            .playlists_pane_elem_icon .fa-music{
                color: #00eecc;
                font-size: xxx-large;
                margin: 32%;
            }

            .playlists_pane_elem_container:hover {
                box-shadow: inset black 0 3px 5px 1px;
            }

            .playlists_pane_elem_icon{
                width: 100%;
                height: 80%;
                left: 15%;

                float: left;
            }

            .playlist_title{
                background: #1e1e1e4f;
                display: inline-block;
                color: white;
                text-align: center;
                width: 100%;
                font-size: large;
                height: 19%;

            }


            #tracklistTab{
                position: absolute;
                width: 100%;
                float: right;
                height: 90%;
                overflow-y: scroll;
                scroll-behavior: smooth;
                overflow-x: hidden;
                border-radius: 4%;
                background: radial-gradient(black, transparent);
                /*backdrop-filter: blur(10px);*/
                top: 8%;
                transition: 1s linear;
                opacity: 0;
            }

            #searchedTracksTab{
                border: 1px solid #000000;
                position: absolute;
                width: 100%;
                float: right;
                height: 90%;
                overflow-y: scroll;
                overflow-x: hidden;
                scroll-behavior: smooth;
                border-radius: 4%;
                box-shadow: -4px 0 13px 5px inset #030303;
                background: #e6e6fa00;
                /*backdrop-filter: blur(10px);*/
                z-index: 10;
                top: 8%;
                transition: 1s linear;
            }
            #searchedTracksTab::-webkit-scrollbar{
                display: none;
            }
            #playListsPane::-webkit-scrollbar{
                display: none   ;
            }
            #tracklistTab::-webkit-scrollbar{
                display: none   ;
            }
            #artistImageWraper{
                position: relative;
                width: 150px;
                height: 150px;
                border-radius: 50%;
                float: left;
                margin: 5px;
                box-shadow: black 0 0 4px 1px;
            }
            #artistImage{
                position: relative;
                height: 100%;
                width: 100%;
                border-radius: 50%;
                box-shadow: black 0 0 4px 1px;
            }
            #artistName{
                position: relative;
                width: 100px;
                height: 20px;
                float: left;

            }
            #audioSearchButton{
                position: relative;
            }
            #audioHolder{
                position: relative;
            }
            .tracklistElem:hover{
                will-change: box-shadow;
                box-shadow: inset 0 0 5px 0 #fafafa;
                transition: 0.4s linear;
                /*display: flex;*/

            }


            .tracklistElem{
                overflow: hidden;
                transition: 0.4s;
                width: 100%;
                height: 8%;
                display: flex;
                justify-content: flex-start;
                color: #ccff0af9;
                font-weight: bolder;
                font-size:  larger;
                font-family: sans-serif;
                cursor: pointer;
                border: 1px solid #101010d1;
            }
            .tracklistElem div:nth-child(2){
                flex: none;
                width: 20em;
            }
            .tracklistElem div:nth-child(3){
                flex: none;
                width: 20em;
            }
            .artistName{
                width: 15em;
                text-align: left;
                text-shadow: 0 -2px 3px black;
                padding: 15px;
                margin-left: 8em;
                overflow-y: scroll;
                overflow-x: hidden;
            }
            .songName{
                overflow-x: hidden;
                overflow-y: scroll;
                width: 20em;
                height: 50%;
                margin-left: -19px;
                padding: 15px;
                text-align: left;
                text-shadow: 0 -2px 3px black;
            }


            .songName::-webkit-scrollbar{
                display: none;
            }
            .artistName::-webkit-scrollbar{
                display: none;
            }

            #container-area{
                position: absolute;
                width: 50px;
                height: 50px;
                perspective: 2500px;
                left: 30%;
                top: 30%;
                z-index: 99999999;
            }
            #mainWrapper{
                position: absolute;
                perspective: 3000px;
                width: 100%;
                height: 100%;
                background: rgb(18 18 18);

            }
   /* было ALT + ENTER --->  пдобавить в касом либы нечто что есть webkit   <--- */
            @-webkit-keyframes spin {
                from { -webkit-transform: rotateY(0) rotateX(0); }
                to   { -webkit-transform: rotateY(-360deg) rotateX(360deg); }
            }

            #blur{
                position: absolute;
                width: 100%;
                height: 100%;
                backdrop-filter: blur(5px);
                z-index: 5;
                transition: 1s linear;
            }
            .trackElementButton {
                font-size: 25px;
                margin: 15px;
                opacity: 1;
                transition: 0.3s linear;
                color: #545454;
            }
            .trackElementButton:hover{
                will-change: text-shadow;

                cursor: pointer;
                color: white;
                text-shadow: 0 0 4px 0 white;
            }

            .playlistAddButton{
                margin: 15px;
                font-size: 25px;
                opacity: 0;
                transition: 0.2s linear;
                color: #545454;
            }
            .audioPlaying{
                margin: 15px;
                font-size: 25px;
                opacity: 1;
                transition: 0.2s linear;
                color: #545454;
            }
            .playlistAddButton:hover{
                will-change: text-shadow;
                color: white;
                text-shadow: 0 0 4px 0 white;
            }
            .addButtonMenu{
                width: 0;
                height: 0;
                border: 1px solid #000000;
                background: #1c1c1c;
                transition: 0.3s linear;
                display: inherit;
                transform: translateY(-20%);
                border-radius: 5%;
                overflow: hidden;
                padding: 0;
            }
            #artistHeader{
                width: 45%;
                height: 3%;
                margin-left: 4%;
                display: inline-block;
                float: left;
                text-align: center;
                /* float: left; */
                color: white;
                font-size: 25px;
                font-family: monospace;

            }
            #trackHeader{
                width: 30%;
                font-size: 25px;
                text-align: center;
                color: #3d4d51;
                height: 3%;
                /* float: right; */
                display: inline-block;
                font-family: monospace;
            }
            .buttons{
                /*width: 15%;*/
                height: 5%;
                transform: translateX(-50px);
                transition: 0.5s ease-out;
                position: absolute;
                display: flex;
            }

            .plusLbl{
                position: absolute;
                font-size: 15px;
                font-style: initial;
                color: white;
            }
            .addBtnMenuIcon{
                position: relative;
                float: left;
                padding: 5%;
                font-size: 20px;
                font-style: initial;
                color: cyan;
            }
            .addBtnMenuTitle{
                position: relative;
                margin-left: 25%;
                margin-top: 8%;
                font-size: 50%;
                color: white;

            }

            .addBtnMenuElem{
                display: block;
                float: left;
                width: inherit;

            }
            .addBtnMenuElem:hover{
                box-shadow: 0 0 19px 3px black inset;
                transition: 0.3s;
            }
            #tracklistWraper{

                position: relative;
                width: 60%;
                float: right;
                overflow: hidden;
                height: 90%;
                border: 1px solid #202020;
                top: 8%;
                border-radius: 2%;
                background: linear-gradient(#03030396 10%, #101010);
                left: -18%;
                z-index: 10;
            }
            #test1{
                width: 100%;
                z-index: 11;
                position: absolute;
                height: 3%;
            }
            #test2{
                width: 100%;
                z-index: 11;
                position: absolute;
                top: 97%;
                height: 3%;
            }
            #x{
                position: relative;
                top: 5%;
            }
            .plusLbl{
                transition: 0.5s linear;
            }

            .menuButtons{
                position: relative;
                text-align: justify;
                padding-left: 20%;
                margin: 5%;
                width: 70%;
                text-shadow: 2px 1px 3px black, 0 2px 3px #000000;
                font-family: 'Audiowide';
                cursor: pointer;
                font-size: x-large;
                transition: 0.2s linear;
            }
            /*.menuButtons:hover{text-shadow:  0 0 4px #00ffc4;}*/

            #menuButtonsWrapper{
                z-index: 22;
                position: absolute;
                height: 100%;
                width: 15%;
                background: rgb(18 18 18 / 78%);
                overflow: hidden;
                transition: 0.7s;
            }
            #displ{
                position: absolute;
                display: none;
                width: 100%;
                z-index: 11;
                opacity: 0;
                transition: 1s linear;
                height: 100%;
                background: radial-gradient( #000000ed 383%, #000000d4);
            }
            #search_inpt_icon{
                padding: 7px;
                transition: 0s;
                color: #ffffff;
                text-shadow: 0 0 3px white;
                flex: none;
            }
            #addNewPlaylistButton{
                top: 36%;
                left: 45%;
            }
            #addNewPlaylistTitle{
                width: 0;
                height: 30px;
                border: none;
                outline: none;
                transition: 0.5s linear;
                margin: 2px;
                background: none;
                color: #00ff9f;
                font-size: 20px;
                font-family: Audiowide,monospace;
                font-weight: bolder;
            }
            #addBWrapper{
                margin:110px;
            }



            .playlist{
                color: #00fdff;
                display: flow-root;
                margin: 15px;
                font-family: Comfortaa, monospace;
                font-size: 20px;
                font-weight: bolder;
                transform: translateX(30%);
                cursor: pointer;
            }
            #playlistsWraper{
                width: 80%;
                border: 1px solid gold;

            }

            #playListsPane{
                position: absolute;
                width: 100%;
                float: right;
                height: 90%;
                overflow-y: scroll;
                overflow-x: hidden;
                border-radius: 4%;
                opacity: 0;
                background: #e6e6fa00;
                z-index: 10;
                top: 8%;
                transition: 1s linear;
                display: none;
            }
            span{
                position: absolute;
                font-size: 26px;
            }
            #heart{
                color: white;
            }

            .playlistsIcon {
                position: relative;
                margin: 3%;
                width: 10%;
                float: left;
                padding-left: 1%;
                font-weight: 600;
                font-size: xx-large;
                text-shadow: 0px -2px 4px black, 2px 3px 2px #000000;
            }

                    #icon_container{
                        position: absolute;
                        height: 100%;
                        background: black;
                        width: 18%;
                        padding: 10%;
                        z-index: 1;
                            }
                    /*#button_container{*/
                    /*    height: 100%;*/
                    /*    z-index: 0;*/
                    /*    margin: 0%;*/
                    /*    padding: 9%;*/
                    /*    position: absolute;*/
                    /*    width: 100%;*/
                    /*    background: black;*/
                    /*    transform: translateX(-200px);*/
                    /*    transition: 0.7s linear;*/
                    /*}*/

                    .button_container{
                        display: block;
                        width: 100%;
                        margin-top: 11%;
                        height: 5%;
                        padding: 5%;
                        transform: translateY(150px);
                    }



                    #content_hider{
                        position: absolute;
                        z-index: 1;
                        transform: translateX(75px);
                        width: 100%;
                        height: 100%;
                        background: rgb(18 18 18);
                        transition: 0.7s ease-out;
                        box-shadow: 4px 0 6px 0px inset #000000
                    }


                    #pl_tracks{
                        position: absolute;
                        top: 40%;
                        width: 100%;
                        height: 60%;
                        background: linear-gradient(10deg, #000000, #0000001f);
                        box-shadow: 0 0 12px 5px black;
                        backdrop-filter: blur(2px);

                    }

                    #playlist_image_container{
                        position: absolute;
                        width: 100%;
                        background-image: none;
                        height: 110%;
                    }

                    .current_playlist_tracks{
                        overflow: hidden;
                        transition: 0.4s;
                        width: 60%;
                        height: 14%;
                        display: flex;
                        justify-content: flex-start;
                        color: #ccff0af9;
                        font-weight: bolder;
                        padding: -3px;
                        margin: 1%;
                        transform: translateY(-8px) translateX(20%);
                        font-size: larger;
                        font-family: sans-serif;
                        cursor: pointer;
                            }

                    .cur_playlist_img{
                     width: 100%;
                        height: 110%;
                        background-image: none;
                        background-size: contain;
                        opacity: .2;

                    }

                    #cur_playlist_title{
                        color: white;
                        position: absolute;
                        top: 5%;
                        left: 27%;
                        width: 110%;
                        text-decoration-line: underline;
                        margin: 4%;
                        padding: 4%;
                        backdrop-filter: blur(3px);
                        font-size: 75px;
                        text-shadow: 1px 1px 3px #ffffff, 2px 0 1px #ffffff;
                        font-family: 'Audiowide';
                        height: 8%;

                    }
                    #playlistElement{
                        display: block;
                        width: 60%;
                        height: 10%;
                        border: 1px solid red;

                    }
            .pl_elem_play_btn{
                display: inline;
                width: 10%;
                height: 100%;
                color: blue;
            }
            .pl_play_icon{

            }
            .pl_artistName{
                display: inline;
            }
            .pl_songName{
                display: inline;
            }



</style>
    </head>
    <body>
    <div id="mainWrapper">
        <div id="searchWrapper">
            <i class="fa-solid fa-search" id="search_inpt_icon"></i><input type="text" id="search_input">
        </div>

    <div id="volumeBar">
        <div id="volumeP"></div>
    </div>
    <div id="audioControls" >
        <button id="play_pause"><i class="audioPlaying fa-solid fa-play" id="play_pause_lbl"></i></button>

        <div id="muteBox">
            <button id="mute_unmute"><i class="fa-solid fa-volume-high" id="mute_unmute_lbl"></i></button>
        </div>
    </div>






    <audio src="" crossorigin="anonymous"></audio>

    <div id="canvasWrapper">
        <div id="can1wrapper">
            <canvas id="can1"></canvas>
        </div>
        <div id="can2wrapper">
            <canvas id="can2"></canvas>
        </div>
        <div id="audioHolder">
            <div id="audioBox">
                <div id="progressBar">
                    <div id="progress"></div>
                </div>
            </div>
        </div>
        <div id="can3wrapper">
            <canvas id="can3"></canvas>
        </div>
        <div id="can4wrapper">
            <canvas id="can4"></canvas>
        </div>

    </div>




    <div id="audioPane" style="position:absolute; width: 500px; height: 300px; top: 30%; border: 2px solid red">
        <div id="artistImageWraper">
            <img id="artistImage" src="">
        </div>
        <div id="artistName"></div>
    </div>

    <div id="container-area">
        <div class="container">
            <div id="back" class="side">
                <canvas id="canvas4"></canvas>
            </div>
            <div id="left" class="side"></div>
            <div id="right" class="side">
                <!--            <div id="login">Sign in</div>-->
                <!--            <canvas id="can3"></canvas>-->
                <canvas id="canvas3"></canvas>

            </div>
            <div id="top" class="side"></div>
            <div id="bottom" class="side">
                <div id="registration">Sign up</div>
            </div>
            <div id="front" class="side">
                <div id="timeBox">00:00 / 00:00</div>

            </div>
        </div>
    </div>

        <div id="tracklistWraper">

            <div id="currentArtistTab"></div>
            <div id="currentAlbumTab"></div>
            <div id="playListsPane"></div>

            <div id="test" style="
             position: absolute;
             width: 100%;
             z-index: 121212;
             height: 100%;
             opacity: 0;
             display: none;
             transition: 1s linear;">
                <div id="playlist_image_container">
                    <div class="cur_playlist_img"></div>
                </div>
                <div id="cur_playlist_title"></div>

                <div id="pl_tracks"></div>

            </div>

            <div id="tracklistTab"></div>
            <div id="searchedTracksTab"></div>
            <div id="displ">
                <div id="addBWrapper">
                    <button type="button" id="addNewPlaylistButton"><i class="fa-solid fa-plus"></i></button>
                    <input type="text" id="addNewPlaylistTitle" placeholder="Create New PLaylist">
                </div>
                <div id="playlistsWraper"></div>
            </div>
        </div>

    <div id="menuButtonsWrapper">
        <div id="content_hider"></div>
      <div class="button_container"> <span class="material-symbols-outlined playlistsIcon">library_music</span>  <div id="tracklistButton" class="menuButtons">Tracklist</div></div>
        <div class="button_container">  <i class="fa-solid fa-music playlistsIcon" ></i> <div id="playlistsButton" class="menuButtons">Playlists</div></div>
        <div class="button_container"> <i class="fa-solid fa-thumbs-up playlistsIcon" ></i> <div id="LikedlistButton" class="menuButtons">Liked</div> </div>
        <div class="button_container">  <i class="fa-solid fa-record-vinyl playlistsIcon" id="heart"></i> <div id="AlbumsListButton" class="menuButtons">Albums</div> </div>
        <div class="button_container"> <span class="material-symbols-outlined playlistsIcon">person</span><div id="ArtistsListButton" class="menuButtons">Artists</div> </div>






        </div>
<!--    <div id="settingPane">-->
<!--        <div class="canvasSettingsPane">-->
<!--            <input type="color" id="can1colorinput">-->
<!--            <input type="color" id="can1shadowinput">-->
<!--            <input type="range" id="can1height" min="10" max="2000">-->
<!--        </div>-->
<!--        <div  class="canvasSettingsPane">-->
<!--            <input type="color" id="can2colorinput">-->
<!--            <input type="color" id="can2shadowinput">-->
<!--            <input type="range" id="can2height" min="1" max="10">-->
<!--        </div>-->
<!--        <div class="canvasSettingsPane">-->
<!--            <input type="color" id="can3colorinput">-->
<!--            <input type="color" id="can3shadowinput">-->
<!--            <input type="range" id="can3height" min="1" max="10">-->
<!--        </div>-->
<!--        <div class="canvasSettingsPane">-->
<!--            <input type="color" id="can4colorinput">-->
<!--            <input type="color" id="can4shadowinput">-->
<!--            <input type="range" id="can4height" min="1" max="10">-->
<!--        </div>-->
<!--    </div>-->


    </div>



    <script type="text/javascript">

    let progress = document.getElementById("progress");
    let progressBar = document.getElementById("progressBar");
    let timeBox = document.getElementById("timeBox");

        let audioContext = null;


        let canvas1 = document.getElementById("can1");
        let canvas2 = document.getElementById("can2");

        let bufferLength;

        let can1_context = canvas1.getContext("2d");
        let can2_context = canvas2.getContext("2d");

        let WIDTH = canvas1.width;
        let HEIGHT = canvas2.height;
///=/-/-/-/-/-/-/--/-/-/


    function updateCurrentAlbumTab(){

    }

    function updateCurrentArtistTab(){

    }

    function updateCurrentPlaylistTab(){

    }


    //////////////-/-/-/--/-/-/-/--





        let dataArray;
        let source;
        let startedAt = null;
        let duration = null;

    let play_pause_button = document.getElementById("play_pause");
        let play_pause_lbl = play_pause_button.children[0];
        let stop_btn;

    let interval;
    let audioBuffers;

    let artistImage = document.getElementById("artistImage");
    let artistName = document.getElementById("artistName");

window.onload = function(){audioBuffers = []; source = null;}


    let rate;
    let playbackTime;
    let totalTime;
    let currentTime;

    let gainNode;
    let analyzer;
    let isPlaying = false;


function  update_artistInfo(){
    if(current_tab_playing === "searchedTracksTab"){
        if(search_data.data.length === numba){numba = 0;}
        audio_url = search_data.data[numba].preview;

        artistImage.src = search_data.data[numba].artist.picture_medium;
        artistName.innerText = search_data.data[numba].artist.name;
    }else if(current_tab_playing === "tracklistTab"){


        if(tracklist.tracks.length === numba){
            numba = 0;
            console.log('2222222');
        }
        audio_url = tracklist.tracks[numba].url;

        artistImage.src = tracklist.tracks[numba].artist_picture;
        artistName.innerText = tracklist.tracks[numba].artist.name;
    }
}



    async function load_and_decode() {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", audio_url);
        xhr.responseType = "arraybuffer";
        xhr.onload =  whenLoaded;
        xhr.send();

         async function whenLoaded(e) {
            var data = xhr.response;

            if(data === null){alert('problem on load');}

            await   audioContext.decodeAudioData(data,whenDecoded,decodingError);

            play(numba);
             await search_cache.add(new Request(audio_url));

             console.log('numba  val'+ numba + 'after decoding');

        }
        function whenDecoded(audiobuffer){
             audioBuffers.push(audiobuffer);
             console.log(audioBuffers.length);

         }
        function decodingError(){

             console.log('ERROR during data decoding');

            if(isPlaying === true){
                source.stop(); source.disconnect();   clearInterval(interval); interval = null;
                progress.style.width = 0 + '%';
                timeBox.innerText = '00:00/00:00';
                playbackTime = null; rate = null; startedAt = null; duration = null;
                isPlaying = false;
            }

            numba+=1; update_artistInfo();  load_and_decode(numba);

        }

    }

    let rate_counter = null;
    function change() {
    console.log(rate);
        if(rate === 100){
            clearInterval(interval);
            interval = null;
            source.stop();
            source.disconnect();
            isPlaying = false;
            progress.style.width = 0 + '%';
            timeBox.innerText = '00:00/00:00';
            playbackTime = null;
            rate = null;
            startedAt = null;
            duration = null;
            rate_counter = null;
            document.getElementById(current_tab_playing).children[numba].children[0].children[0].classList.add('fa-play');
            document.getElementById(current_tab_playing).children[numba].children[0].children[0].classList.remove('fa-pause');
            numba+=1;

            update_artistInfo();
            load_and_decode(numba);
        }
        if(rate >=97 && rate_counter === null){
            gainNode.gain.cancelScheduledValues(0.0);
            gainNode.gain.setValueAtTime(0.01, audioContext.currentTime);

            gainNode.gain.linearRampToValueAtTime(0.01,audioContext.currentTime+1);
            rate_counter = 1;
        }
            playbackTime = Math.floor((Date.now() - startedAt) / 1000);
            console.log(playbackTime + ' '  + startedAt);
            rate = Math.floor((playbackTime * 100) / duration);
            progress.style.width = rate + '%';
            totalTime = smartTime(Math.floor(duration / 60)).toString() + ':' + smartTime(Math.floor(duration % 60)).toString();
            currentTime = smartTime(Math.floor(playbackTime / 60).toString()) + ':' + smartTime(Math.floor(playbackTime % 60)).toString();
            timeBox.innerText = totalTime + '/' + currentTime;
    }

    function play() {
        var playing_now;
        if(numba === 0)
        {playing_now = document.getElementById(current_tab_playing).children[numba];}
        else
        {playing_now = document.getElementById(current_tab_playing).children[numba-1];}

        var need_to_play_now = document.getElementById(current_tab_playing).children[numba];

        if(isPlaying === true){//?!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!watch top
            playing_now.children[0].children[0].classList.add('fa-play');
            playing_now.children[0].children[0].classList.remove('fa-pause');

             source.stop();
             source.disconnect();
             clearInterval(interval);
             interval = null;
             progress.style.width = 0 + '%';
             timeBox.innerText = '00:00/00:00';
             playbackTime = null; rate = null; startedAt = null; duration = null;
             isPlaying = false;
         }
        source = audioContext.createBufferSource();
        source.buffer = audioBuffers[[audioBuffers.length-1]];
        console.log(source.buffer);
        duration = source.buffer.duration;

        source.connect(gainNode);//.connect(gainNode).connect(audioContext.destination);
        bufferLength = analyzer.frequencyBinCount;
        dataArray = new Uint8Array(bufferLength);
        startedAt = Date.now();



        source.start();
        interval = setInterval(change,500);

        gainNode.gain.cancelScheduledValues(audioContext.currentTime);
        gainNode.gain.setValueAtTime(0.01,audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(1.0, audioContext.currentTime+1.5);
        isPlaying = true;
        need_to_play_now.children[0].children[0].classList.add('fa-pause');
        need_to_play_now.children[0].children[0].classList.remove('fa-play');
        renderFrame();
    }





    progressBar.addEventListener("click", function (e) {
        clearInterval(interval);
        var buf = source.buffer;

        source.stop();
        source.disconnect();

        source = audioContext.createBufferSource();

        source.buffer = buf;
        source.connect(gainNode);

        rate = Math.floor((e.clientX * 100) / progressBar.offsetWidth);
        playbackTime = Math.floor(duration * rate) / 100;
        startedAt = Math.floor(Date.now() - playbackTime    * 1000);
        progress.style.width = rate + '%';

        setTimeout(function () {progress.style.transition = "1s linear";}, 400);
        progress.style.transition = "0.4s linear";
        interval = setInterval(change, 500 );
        gainNode.gain.cancelScheduledValues(audioContext.currentTime);
        gainNode.gain.setValueAtTime(1.0, audioContext.currentTime);
        gainNode.gain.setTargetAtTime(0.01,audioContext.currentTime+(duration-(playbackTime-2)), 2);

        source.start(0, playbackTime, duration);


    });

    let smartTime = function smartTime(time) {return time < 10 ? "0" + time.toString().trim() : time};


        let counter;


        function renderFrame() {
            requestAnimationFrame(renderFrame);
            analyzer.getByteFrequencyData(dataArray)
            let barWidth = (WIDTH / bufferLength);
            let barHeight;

            counter = 0;

            can1_context.clearRect(0, 0, WIDTH, HEIGHT);
            can2_context.clearRect(0, 0, WIDTH, HEIGHT);

            for (var i = 0; i < bufferLength; i++) {


                barHeight = dataArray[i];

                can1_context.fillStyle = "#f60228";
                can2_context.fillStyle = "#fafafa";
                can1_context.lineCap = "round";
                can2_context.lineCap = "round";



                can1_context.fillRect(counter+2, HEIGHT - barHeight / 2, barWidth*0.4, barHeight -100);
                can2_context.fillRect(counter, HEIGHT - barHeight / 2, barWidth / 2, barHeight-50 );
                counter += barWidth + 0.8;

            }


        }
        //---------------------------------------------------------------------------------------------------------------//

        play_pause_button.onclick = () => {
            // source.start(0);
            play_pause_lbl.style.opacity = "0";
            setTimeout(function () {
                play_pause_lbl.classList.remove('fa-pause');
                play_pause_lbl.classList.add('fa-play');
                play_pause_lbl.style.opacity = "1";
            }, 200);
        }

        ////////////////






    /////////////
    let currentTab = null;
    let lastTab;

    let tracklistButton = document.getElementById("tracklistButton");
    let playlistsButton = document.getElementById("playlistsButton");

    let tracklistTab = document.getElementById("tracklistTab");
    let playlistsTab = document.getElementById("playListsPane");

    let previous_button = null;


    tracklistButton.addEventListener("click", function(){
        change_current_tab(tracklistTab);
        change_button(tracklistButton)
    });
    playlistsButton.addEventListener("click",function(){
        change_current_tab(playlistsTab);
        change_button(playlistsButton);
    });





    let selectPlaylistTab = document.getElementById("displ");
    let searchedTracksTab = document.getElementById("searchedTracksTab");
    let searchButton = document.getElementById("search_inpt_icon");
    let searchInput = document.getElementById("search_input");

    let search_cache = null;
    let search_data = null;

    //
    //fetch validation ---------------------------
    //

    let show = function () {document.getElementById("addBWrapper").children[1].style.width = "10em";}
    let hide = function (e) {e.stopPropagation();document.getElementById("addBWrapper").children[1].style.width = "0";}

    //ПЛЮСИК В ВЫБОРЕ ПЛЕЙЛИСТОВ +  РАСШИРЕНИЕ.СУЖЕНИЕ строки поиска//////
    selectPlaylistTab.children[0].addEventListener("mouseover", show);
    selectPlaylistTab.children[0].addEventListener("mouseleave", hide);

    document.getElementById("searchWrapper").onmouseover = function () {
        this.children[1].style.width = "20em";
        this.children[1].style.opacity = "1";
    }
    document.getElementById("searchWrapper").onmouseleave = function () {
        this.children[1].style.width = "0em";
        this.children[1].style.opacity = "0";
        // this.style.width = "15em";
    }
    document.addEventListener("mousemove", function (e) {
        if(e.clientX < 100) {document.getElementById("content_hider").style.transform = "translateX(270px)";}

    });

    document.getElementById("menuButtonsWrapper").onmouseleave = function() {document.getElementById("content_hider").style.transform = "translateX(75px)";}
    let buttons = document.querySelectorAll(".button_container");
    buttons.forEach((e) => {
        e.addEventListener("mouseover", function (e) {
            this.children[0].style.transition = "0.5s";
            this.children[0].style.textShadow = "0px 0px 2px white, 0px 0px 1px #f7f7f7";
            this.children[1].style.textShadow = "0px 0px 2px white, 0px 0px 3px #f7f7f7";
        });
        e.addEventListener("mouseleave", function (e) {
            this.children[0].style.textShadow = "0px 1px 3px black, 1px 2px 2px #000000";
            this.children[1].style.textShadow = "1px 0 3px black, 0 1px 3px #000000";
        });
    });

        let cache;

    let tracklist;
    let playlists;
    let playlist_tracks_identificators
    let tracklist_tracks_identificarors;

    let searchTabChildNodes;

    //фУНКЦИЯ ПОИСКА---------------------------------------------------------------
        let search = async function () {
            change_current_tab(searchedTracksTab);

            searchButton.style.transition = "0s";
            searchButton.className = "fa-solid fa-rotate";
            searchButton.style.transition = "2s linear";

            searchButton.style.transform = "rotate(1000deg)";

            setTimeout(function (){
                searchButton.style.transition = "0s";
                searchButton.style.transform = "rotate(0deg)";
                searchButton.className = "fa-solid fa-search";
            },2000);



            let resp = await fetch(new Request(uri+'/music?name=' + searchInput.value));
            searchTabChildNodes = searchedTracksTab.children;
            if (search_cache === null) {search_cache = await caches.open("audio_search_cache")}
            await search_cache.add(new Request(uri+'/music?name=' + searchInput.value));

            search_data = await resp.json();


            if (searchedTracksTab.children.length === 0) {
                for (let x = 0; x < search_data.data.length; x++) {create_tracklistTab_element(x);}
            } else {
                for (let x = 0; x < searchTabChildNodes.length; x++) {
                    searchTabChildNodes[x].children[1].innerText = search_data.data[x].artist.name;
                    searchTabChildNodes[x].children[2].innerText = search_data.data[x].title;
                }
            }

        };

    let createEl = function (data) {
        let div = document.createElement("div");
        div.className = "tracklistElem";
        // div.setAttribute("number",data);
        div.innerHTML =
            '<div class=\"buttons\"><i class=\"trackElementButton fa-solid fa-play\"></i>' +
            '<i class=\"playlistAddButton fa-solid fa-plus">' +
            '<ul class="addButtonMenu" number=\"' + data + '\">' +
            '<li class=\"addBtnMenuElem\"><i class=\"addBtnMenuIcon fa-download\"></i><div class=\"addBtnMenuTitle\">download</div></li>' +
            '<li class=\"addBtnMenuElem\"><i class=\"addBtnMenuIcon fa-share\"></i><div class=\"addBtnMenuTitle\">share</div></li>' +
            '<li class=\"addBtnMenuElem\"><i class=\"plusLbl fa-plus\"></i><i class=\"addBtnMenuIcon fa-music\"></i><div class=\"addBtnMenuTitle\">add to playlist</div></li>' +
            '<li class=\"addBtnMenuElem\"><i class=\"plusLbl fa-plus\"></i><i class=\"addBtnMenuIcon fa-music\"></i><div class=\"addBtnMenuTitle\">add to tracks</div></li>' +
            '</ul>' +
            '</i></div>' +
            '<div class=\"artistName\">' + search_data.data[data].artist.name + '</div>' +
            '<div class=\"songName\">' + search_data.data[data].title + '</div>' +
            '<div class=\"trackSettings\"></div>';

        return div;
    }

    let update_local_tracklist = function (){localStorage.setItem("tracklist", JSON.stringify(tracklist));}
    let update_local_tracks_ids = function (){localStorage.setItem("tracks_identificators", JSON.stringify(tracklist_tracks_identificarors));}

    let update_local_playlists = function(){
        localStorage.setItem("playlists", JSON.stringify(playlists))
        localStorage.setItem("playlists_titles", JSON.stringify(pl_titles));
    };










let numba;
    let current_tab_playing = null;


    let initListeners = function(el, data) {

        let ul = el.children[0].children[1].children[0];
        let elem = el;
        el.addEventListener("mouseover", function () {
            el.children[0].style.transform = "translateX(15px)";
            el.children[0].style.opacity = "1";
            el.children[0].children[1].style.opacity = "1";
            el.style.color = "red";
        });

        el.addEventListener("mouseleave", function () {
            el.children[0].children[1].style.opacity = "0";
            // div.children[0].style.opacity = "0";
            el.children[0].style.transform = "translateX(-50px)";
            el.style.color = "#ccff0af9";
        });

        el.children[0].children[1].addEventListener("click", function (t) {
            el.children[0].children[1].style.color = "black";  // ИЛИ this
            ul.style.display = "inherit";
            setTimeout(function () {
                ul.style.width = "200px";
            }, 10);
            setTimeout(function () {
                ul.style.height = "170px";
                ul.style.opacity = "1";
            }, 100);
        });

        ul.addEventListener("mouseleave", function (e) {
            e.stopPropagation();

            setTimeout(function () {ul.style.width = "0px"}, 50);
            setTimeout(function () {ul.style.display = "none";}, 400);//<------

            ul.parentElement.style.color = "cyan";
            ul.style.height = "0px";
        });

        //add to playlist CLICK
        ul.children[2].addEventListener("click", function () {
            change_current_tab(selectPlaylistTab);
            if (lastTab.id === "searchedTracksTab") {
                track_for_playlist_adding = search_data.data[parseInt(ul.getAttribute("number"), 10)].id;
                console.log(track_for_playlist_adding + "   id of variable \'track_for_playlist_adding\'    FROM SEARCH_TAB");
            } else if (lastTab.id === "tracklistTab") {
                console.log(ul.parentElement.parentElement.getAttribute("id"));
                track_for_playlist_adding = ul.getAttribute("id");
                console.log(track_for_playlist_adding + "   id of variable \'track_for_playlist_adding\'    FROM TRACKLIST_TAB");
            }
        });

        el.children[0].children[0].addEventListener('click',  function (e) {
            if(isPlaying === true && current_tab_playing != null){
                var ee = document.getElementById(current_tab_playing).children[numba];

                ee.children[0].children[0].classList.add('fa-play');
                ee.children[0].children[0].classList.remove('fa-pause');

            }
            var parent_elem= e.target.parentElement.parentElement.parentElement;
            if(audioContext === null){
                audioContext = new AudioContext();
                analyzer = audioContext.createAnalyser();
                analyzer.fftSize = 512;
                gainNode = audioContext.createGain();
                gainNode.connect(analyzer);
                analyzer.connect(audioContext.destination);
            }

            if ( parent_elem.id === 'searchedTracksTab') {
                numba = parseInt(e.target.parentElement.children[1].children[0].getAttribute("number"));
                audio_url = search_data.data[numba].preview;
                console.log(numba + '    NUM');
                current_tab_playing = parent_elem.id;

            }else{
                if(parent_elem.id === 'tracklistTab'){

                    current_tab_playing = parent_elem.id;
                    var id_atr = e.target.parentElement.children[1].children[0].getAttribute("id");
                    tracklist = local_get_tracklist();
                    // numba = 0;
                    numba = local_get_tracks_ids().identificators.indexOf(parseInt(id_atr,10),0);
                    audio_url = tracklist.tracks[numba].url;

                    console.log(numba + '    ID');
                    console.log(audio_url);
                }
            }
            update_artistInfo();
            load_and_decode(numba);

        })
    }

    let local_get_tracklist = function (){return JSON.parse(localStorage.getItem("tracklist"));}
    let local_get_tracks_ids = function (){return JSON.parse(localStorage.getItem("tracks_identificators"));}

    let local_get_playlists = function (){return JSON.parse(localStorage.getItem("playlists"));}
    let local_get_playlists_titles = function (){return JSON.parse(localStorage.getItem("playlists_titles"));}

    // controller = new AbortController();


    let add_to_tracklist =  function(el){

        tracklist =  local_get_tracklist();
        tracklist_tracks_identificarors = local_get_tracks_ids();

        let ul = el.children[0].children[1].children[0];
        let num = ul.getAttribute("number");



        let trackObject = {
            id: search_data.data[num].id,
            artist: {name: search_data.data[num].artist.name},
            track_id: search_data.data[num].id,
            artist_id: search_data.data[num].artist.id,
            artist_name: search_data.data[num].artist.name,
            artist_picture: search_data.data[num].artist.picture_big,
            artist_tracklist: search_data.data[num].artist.tracklist,
            album_id: search_data.data[num].album.id,
            title: search_data.data[num].title,
            url: search_data.data[num].preview,
            duration: search_data.data[num].duration,
            isLiked: false,
            timeMarks: []
        }
        if (tracklist_tracks_identificarors.identificators.includes(trackObject.track_id) === false) {
            tracklist_tracks_identificarors.identificators.push(trackObject.track_id);
            tracklist.tracks.push(trackObject);
            update_local_tracklist();
            update_local_tracks_ids();

            let ele = createEl(num);
            var tracklistUl = ele.children[0].children[1].children[0];
            tracklistUl.setAttribute("id", trackObject.id.toString());
            // tracklistUl.removeAttribute("number");
            tracklistUl.children[3].children[2].innerText = "remove from tracklist";
            tracklistTab.appendChild(ele);
            initListeners(ele);
            // ele.children[0].children[1].children[0].children[3].addEventListener('click',function(){remove_from_traklist(ele)},{once:true});
            add_to_tracklist_request(trackObject);

            tracklistUl.children[3].children[0].style.transform = "rotate(45deg)";
            tracklistUl.children[3].children[0].style.color = "red";
            tracklistUl.children[3].children[2].innerText = 'remove from tracks';
            ul.children[3].children[0].style.transform = "rotate(45deg)";
            ul.children[3].children[0].style.color = "red";
            ul.children[3].children[2].innerText = 'remove from tracks';
            tracklistUl.children[3].addEventListener('click', function(e){
                e.stopPropagation();
                remove_from_traklist(tracklistUl.parentElement.parentElement.parentElement)},{once : true});

            ul.children[3].addEventListener('click', function(e){
                e.stopPropagation();
                remove_from_traklist(ul.parentElement.parentElement.parentElement);
            },{once:true});
        }else{
            console.log('track already in your trracklist');
        }
    }


  function remove_from_traklist(el) {
        let ul = el.children[0].children[1].children[0];
        let val;
        let numb;
        let c;
        var index;


        tracklist = local_get_tracklist();
        tracklist_tracks_identificarors = local_get_tracks_ids();

        if (ul.closest("#tracklistTab")) {
            val = ul.getAttribute("id");
            console.log(val + '   ---VAL1')

            numb = ul.getAttribute("number");
            console.log(numb + '   ---VAL1')

            index  = tracklist_tracks_identificarors.identificators.indexOf(parseInt(val, 10), 0);

            let del_el = document.getElementById(val.toString()).closest(".tracklistElem");
            console.log(del_el.innerHTML);
            del_el.style.height = "0%";
            setTimeout(function(){ del_el.remove();},800);
            let c = searchedTracksTab.children[numb];
            let c_ul =  c.children[0].children[1].children[0];
            c_ul.children[3].children[0].style.transform = "rotate(0deg)";
            c_ul.children[3].children[0].style.color = "white";
            c_ul.children[3].children[2].innerText = 'add to tracklist';
            c_ul.children[3].addEventListener('click',function (){add_to_tracklist(c_ul.parentElement.parentElement.parentElement)},{once : true});

            console.log('idid');

        }
        else if(ul.closest("#searchedTracksTab")) {
            val = ul.getAttribute("number");
            index =   tracklist_tracks_identificarors.identificators.indexOf(parseInt(search_data.data[val].id, 10), 0);

            console.log(search_data.data[val].id.toString() + '   <--- VAL')

            let del_el = document.getElementById(search_data.data[val].id.toString()).closest(".tracklistElem");
            console.log('DEL EL ____ ' + del_el);
            ul.children[3].addEventListener('click',function (){add_to_tracklist(ul.parentElement.parentElement.parentElement)},{once: true});
            del_el.remove();

            console.log('number' + val);

        }
        else {alert('smth went wrong')}

        let deleting_track = tracklist.tracks[index];
        if (tracklist.tracks.splice(index, 1).length === 1 &&
            tracklist_tracks_identificarors.identificators.splice(index, 1).length === 1) {
            update_local_tracklist();
            update_local_tracks_ids();

            remove_from_tracklist_request(deleting_track);
            console.log('deleted');

        } else {console.log('not deleted');}


        ul.children[3].children[0].style.transform = "rotate(0deg)";
        ul.children[3].children[0].style.color = "white";
        ul.children[3].children[2].innerText = 'add to tracklist';

            remove_from_tracklist_request(deleting_track);
        }


    searchButton.addEventListener("click", search, true);


            let addNewPlaylistButton = document.getElementById("addNewPlaylistButton");
            let addNewPlaylistTitle = document.getElementById("addNewPlaylistTitle");

    let create_tracklistTab_element = function (data) {
        let div = createEl(data);
        searchedTracksTab.appendChild(div);
        initListeners(div,data);
        div.children[0].children[1].children[0].children[3].addEventListener('click', function (){add_to_tracklist(div)},{once : true});
    }

let change_button = function (button){


        if (previous_button === null || previous_button === "undefined") {
            previous_button = button;
            button.parentElement.style.color = "white";

        }else {
            previous_button.parentElement.style.color = "black";
            previous_button = button;
            button.parentElement.style.color = "white";
        }

}

            let change_current_tab = function (tab) {
                if(currentTab === null ||currentTab === "undefined") {
                    currentTab = tab;

                }
                else{
                    currentTab.style.opacity = "0";
                    currentTab.style.zIndex = "0";
                    lastTab = currentTab;
                    console.log(lastTab.id + ' lastTAB');

                }
                currentTab = tab;
                currentTab.style.display = "inline";
                currentTab.style.zIndex = "11113";
                setTimeout(function () {currentTab.style.opacity = "1";}, 100);

                console.log(currentTab.id + ' currentTAB');
            };


    let number;
    let pl_titles;
    let track_for_playlist_adding;

    let testTab = document.getElementById("test");
            addNewPlaylistButton.addEventListener("click", async function () {
                playlists = local_get_playlists();
                pl_titles = local_get_playlists_titles();
                tracklist_tracks_identificarors = local_get_tracks_ids();
                tracklist = local_get_tracklist();


                if(!pl_titles.titles.includes(addNewPlaylistTitle.value)) {
                    let newPLElement = document.createElement("div");
                    newPLElement.innerText = addNewPlaylistTitle.value;
                    let newPLText = newPLElement.innerText;


                    number = playlists.lists.length;
                    newPLElement.setAttribute("number", number.toString());
                    newPLElement.className = "pl_select_el";


                    console.log('html элемент ПЛЕЙЛИСТА успешно создан! innerText = __'+newPLText.toString());
                    selectPlaylistTab.appendChild(newPLElement);

                    var playlist_tab_el = document.createElement("div");
                    playlist_tab_el.className = "playlists_pane_elem_container"; //+ ..icon
                    playlist_tab_el.innerHTML =
                        "<div class=\"playlists_pane_elem_icon\"><i class=\"fa fa-music\"></i></div>" +
                        "<div class=\"playlist_title\">"+newPLText+"</div>"+
                        "<div class=\"xz\" style=\"width: 98%; transition: 0.3s ease; height: 98%;transform: translateX(140px) translateY(-150px);backdrop-filter: blur(5px);\">" +

                        "<div class=\"pl_icon_wrapper\"><i class=\"pl_icon fa-solid fa-play\" style=\"color: white; cursor: pointer\"></i></div>" +
                        "<div class=\"pl_icon_wrapper\"><i class=\"pl_icon fa-solid fa-list\" style=\"color: white; cursor: pointer\"></i></div>" +
                        "</div>";


                    //бавить листнеры
                    playlist_tab_el.setAttribute("number", number.toString())
                    playlistsTab.appendChild(playlist_tab_el);



                    playlist_tab_el.addEventListener('mouseover', function (e){playlist_tab_el.children[2].style.transform = "translateY(-155px) translateX(70px)";});
                    playlist_tab_el.addEventListener('mouseleave', function (e){playlist_tab_el.children[2].style.transform = "translateX(140px) translateY(-155px)";});

                    let newPlaylist = {number: number, title: newPLText, tracks: [], image : 'https://e-cdns-images.dzcdn.net/images/cover/73ac351bce721467224777d10fda9ed9/500x500-000000-80-0-0.jpg'};





                    console.log('html элемент ПЛЕЙЛИСТА appended to select/playlistTab\'ам as childNode');
                    console.log('..+ ему установлен атрибут NUMBER со значением:  ' +number);


                    playlists.lists.push(newPlaylist);
                    pl_titles.titles.push(newPlaylist.title);
                    await update_local_playlists();

                    console.log('updated');
                    console.log('playlist object with number : _'+number+'_ + added to localstorage(playlists/+titles)...FROM SearchTab!!!')

                     create_playlist_request(newPlaylist);

//////////////////---


                    let create_playlist_song_element = function (e){
                        let div = document.createElement("div");
                        div.className = "playlistElement";
                        div.innerHTML =
                            '<div class=\"pl_elem_play_btn\"><i class=\"pl_play_icon fa-solid fa-play\"></i></div>' +
                            '<div class="music_info">' +
                            '<div class=\"pl_artistName\"></div>' +
                            '<div class=\"pl_songName\"></div>' +
                            '</div>';
                        document.getElementById("cur_playlist_title").innerText = playlists.lists[parseInt(playlist_tab_el.getAttribute("number"),10)].title;
                        testTab.children[2].appendChild(div);

                    }

///////!!!!!!!!!!!!



                    /////////!!!!!!!!!

                    newPLElement.addEventListener("click", function () {
                        playlists = local_get_playlists();
                        pl_titles = local_get_playlists_titles();

                        let pl_number = parseInt(newPLElement.getAttribute("number"), 10);

                        console.log(pl_number  + '   pl_number');
                        let track_index;
                        let track;
                        let payload;

                        if(lastTab.id === "tracklistTab"){
                            track_index = tracklist_tracks_identificarors.identificators.indexOf(parseInt(track_for_playlist_adding, 10), 0);
                            track = tracklist.tracks[track_index];
                            payload = {track_id:track.id, number : number};
                            console.log(track_index + '    index of track in tracklist(tracklistTab)');

                        }else if(lastTab.id === "searchedTracksTab"){
                            for(let x=0; x<search_data.data.length; x++) {
                                console.log(search_data.data[x].id);
                                console.log(track_for_playlist_adding);
                                console.log(search_data.data[x].id.toString() === track_for_playlist_adding.toString());

                                if(search_data.data[x].id.toString() === track_for_playlist_adding.toString()){
                                    track_index = x;
                                    track = search_data.data[x];
                                    payload  = {track_id : track.id, number : number};
                                    console.log(track_index + '    index of track in searchedTab(!)');

                                }
                            }
                        }


                        console.log(track);

                        let plist = playlists.lists[pl_number];
                        playlists.lists[pl_number].tracks.push(track);
                        update_local_playlists();

                        console.log(plist.title + '  plist_title');

                        add_to_playlist_request(payload);

                        track_for_playlist_adding = null;
                        change_current_tab(lastTab);




                        playlist_tab_el.addEventListener('click',async function (){
                            playlists =  local_get_playlists();
                            let pl_number = playlist_tab_el.getAttribute("number"); //playlists.lists[parseInt(playlist_tab_el.getAttribute("number"),10)];
                            let tracks_number_in_playlist = playlists.lists[pl_number].tracks.length;
                            let cur_playlist_pane_tracks_number = testTab.children[2].children.length;
                            let count_value;

                            if(tracks_number_in_playlist !== 0){
                                if(cur_playlist_pane_tracks_number > tracks_number_in_playlist){
                                    count_value = cur_playlist_pane_tracks_number - tracks_number_in_playlist ;
                                    for(let i = 0; i < count_value; i++){
                                        await testTab.children[2].children[testTab.children[2].children.length-1].remove();
                                    }
                                }else if(cur_playlist_pane_tracks_number < tracks_number_in_playlist){
                                    count_value =tracks_number_in_playlist - cur_playlist_pane_tracks_number ;
                                    for(let i = 0; i < count_value; i++){
                                        await create_playlist_song_element();
                                    }
                                }
                            }else{
                                for(let i =0; i < tracks_number_in_playlist; i++){ await create_playlist_song_element();}
                            }
                            console.log(tracks_number_in_playlist + '      ' +cur_playlist_pane_tracks_number + '   ' + count_value  )

                            for(let i=0; i <testTab.children[2].children.length; i++){console.log(i);
                                testTab.children[2].children[i].children[1].children[0].innerText = playlists.lists[pl_number].tracks[i].artist.name;
                                testTab.children[2].children[i].children[1].children[1].innerText = playlists.lists[pl_number].tracks[i].title;
                            }

                            if(playlists.lists[pl_number].image !== null){
                                testTab.children[0].children[0].style.backgroundImage = "url(\'"+ playlists.lists[pl_number].image + "\')";
                            }
                            change_current_tab(testTab);
                        });
                    });
                }   else{alert('playlist существуеь');}
            });
/////////////



    //https://i.ytimg.com/vi/-qgzNwdkV4s/hqdefault.jpg?sqp=-oaymwEWCMACELQBIAQqCghQEJADGFogjgJIWg&rs=AMzJL3kmILo_PrUlgsedQeixSXPcj-_g4A
    let uri = 'https://a22f-217-107-127-133.ngrok.io';
    let audio_url = null;




    let add_to_tracklist_request =  function(arg){
      let resp =   fetch(uri+'/json?method=add_to_tracklist',{method:'POST',body:JSON.stringify(arg)})
          .then(response => response.json())
          .then(data => {console.log(data.result);});
          // let data =   resp.json();
          // console.log(data.data.albums[0].id);
    };

    let remove_from_tracklist_request = function (arg){
        fetch(uri+'/json?method=remove_from_tracklist',{method:'POST',body:JSON.stringify(arg)})
            .then(response => response.json())
            .then(data => {console.log(data.result);});
    }


    let create_playlist_request = function (arg){
        fetch(uri+'/json?method=create_playlist',{method:'POST',body:JSON.stringify(arg)})
            .then(response => response.json())
            .then(data => {console.log(data.result)});
    }



    let add_to_playlist_request = function (arg){
        fetch(uri+'/json?method=add_to_playlist',{method:'POST',body:JSON.stringify(arg)})
            .then(response => response.json())
            .then(data => {console.log(data.result)});
    }


    ////--------------------------////////////////////----------------------------///////



        </script>
    </body>
</html>